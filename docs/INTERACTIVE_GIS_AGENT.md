# 交互式 GIS Agent 使用指南

## 简介

这是一个在终端中与用户交互的 GIS Agent，可以自动调用天气查询和卫星影像工具。

## 运行方式

```bash
python examples/interactive_gis_agent.py
```

## 功能

### 1. 天气查询 🌤️
- 查询支持城市的实时天气
- 显示温度、湿度、降水量、风速等信息

### 2. 卫星影像获取 🛰️
- 获取城市的卫星影像数据
- 支持保存到本地文件

## 支持的城市

- 北京
- 上海
- 广州
- 深圳
- 成都
- 杭州

## 两种工作模式

### 模式 1: 智能模式（需要 LLM）

配置环境变量后启用：
```bash
export OPENAI_API_KEY='your-api-key'
export OPENAI_BASE_URL='your-base-url'  # 可选
python examples/interactive_gis_agent.py
```

**特点**：
- 自然语言理解
- 自动调用合适的工具
- LLM Function Calling
- 上下文对话记忆

### 模式 2: 简化模式（关键词匹配）

无需配置，直接运行：
```bash
python examples/interactive_gis_agent.py
```

**特点**：
- 关键词匹配
- 快速响应
- 无需 API Key
- 基础功能可用

## 使用示例

### 天气查询示例

```
👤 您: 查询北京的天气

🌤️  正在查询 北京 的天气...

🤖 Agent:
📍 北京 当前天气:
   🌡️  温度: -8.9°C
   💧 湿度: 22%
   🌧️  降水: 0.0 mm
   💨 风速: 8.1 km/h
   ⏰ 时间: 2026-01-20T10:15
```

### 影像查询示例

```
👤 您: 下载上海的卫星影像

🛰️  正在获取 上海 的卫星影像...

🤖 Agent:
📍 上海 卫星影像:
   🗺️  数据源: google
   📐 影像尺寸: 1000x1000 像素
   💾 已保存到: /root/swagent/satellite_images/上海_satellite.png
   📄 文件名: 上海_satellite.png
```

## 命令

- `help` - 显示帮助信息
- `quit` - 退出程序
- `clear` - 清空对话历史（智能模式）

## 更多示例

### 简单查询
```
查询深圳的天气
广州现在温度多少
成都天气怎么样
```

### 影像下载
```
下载北京的卫星影像
获取杭州的卫星图片
保存深圳的影像到文件
```

### 自然语言（智能模式）
```
我想知道北京今天的天气情况
能帮我下载上海的高清卫星图吗
深圳和广州的天气对比一下
```

## 智能模式与简化模式对比

| 功能 | 智能模式 | 简化模式 |
|------|---------|---------|
| 自然语言理解 | ✅ | ⚠️ 关键词 |
| 自动工具选择 | ✅ | ⚠️ 规则匹配 |
| 上下文记忆 | ✅ | ❌ |
| 复杂查询 | ✅ | ❌ |
| 需要 API Key | ✅ | ❌ |
| 响应速度 | 较慢 | 快 |

## 输出文件

使用"下载"或"保存"关键词时，影像会保存到：
```
./satellite_images/
├── 北京_satellite.png
├── 上海_satellite.png
└── ...
```

## 故障排除

### 问题 1: LLM 初始化失败

**症状**：
```
❌ 错误: 未配置 OPENAI_API_KEY 环境变量
```

**解决方案**：
```bash
export OPENAI_API_KEY='your-api-key'
# 或者直接使用简化模式（无需配置）
```

### 问题 2: 工具执行失败

**症状**：
```
❌ 工具执行失败: Google Earth Downloader is not available
```

**解决方案**：
```bash
# 安装依赖
pip install mercantile
```

### 问题 3: 不识别城市

**症状**：Agent 无法识别城市名称

**解决方案**：
- 确保使用支持的城市名称（北京、上海、广州、深圳、成都、杭州）
- 在智能模式下，可以尝试不同的表达方式

## 扩展

如果想添加更多城市，编辑脚本中的 `cities` 字典：

```python
cities = {
    "北京": (116.4074, 39.9042),
    "你的城市": (经度, 纬度),
}
```

## 技术实现

### 核心组件
- **ToolRegistry**: 工具注册和管理
- **WeatherTool**: 天气查询工具
- **ImageryTool**: 影像切片工具
- **OpenAIClient**: LLM 客户端（可选）

### 工作流程

**智能模式**：
```
用户输入 → LLM 理解 → Function Calling → 执行工具 → 返回结果
```

**简化模式**：
```
用户输入 → 关键词匹配 → 执行工具 → 返回结果
```

## 注意事项

1. **网络连接**: 工具调用需要网络访问 API
2. **API 限制**: 注意 API 调用频率限制
3. **LLM 成本**: 智能模式会产生 LLM API 调用费用
4. **数据准确性**: 天气数据来自 Open-Meteo API
5. **影像时效性**: 卫星影像可能不是最新的

## 未来改进

- [ ] 支持更多城市
- [ ] 添加历史天气查询
- [ ] 支持更多卫星数据源
- [ ] 添加数据可视化
- [ ] 支持批量查询
- [ ] 导出查询历史

---

**开始使用**：
```bash
python examples/interactive_gis_agent.py
```

享受与 GIS Agent 的交互吧！🌍
